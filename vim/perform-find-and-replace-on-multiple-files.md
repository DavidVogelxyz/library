# Performing "Find and Replace" on Multiple Files

[Back to the home page](README.md)

## Table of contents

- [Introduction](#introduction)
- [The concept](#the-concept)
- [Performing "find and replace", starting inside of Vim](#performing-find-and-replace-starting-inside-of-vim)
- [Performing "find and replace", starting outside of Vim](#performing-find-and-replace-starting-outside-of-vim)
- [References](#references)

## Introduction

In Vim, it's possible to globally search a file for a pattern and replace it with a different pattern, using a command such as the following:

```
:%s/<PATTERN_TO_REPLACE>/<NEW_PATTERN>/gc
```

Using the Neovim configs found [here](https://github.com/davidvogelxyz/nvim), in combination with the `telescope` plugin, it's possible to run `ripgrep` in Neovim in order to recursively search files for a string.

For reference, the relevant keymap is found in the `after/plugin/telescope.lua` file:

```
builtin.grep_string({ search = vim.fn.input("Grep > ") });
```

However, this begs the question: is it possible to do something similar in order to perform a "find and replace" across multiple files, in a way that allows the user to view and approve each change?

The answer is yes.

## The concept

First, the "quickfix" list needs to be populated with a command like `grep`, `ripgrep`, `vimgrep`, etc.

Next, run a command that allows for editing multiple files, such as `cdo`, `cfdo`, or `bufdo`.

Last, save the changes using `cfdo` or `bufdo`.

## Performing "find and replace", starting inside of Vim

First, populate the "quickfix" list by running `grep`:

```
:grep <SEARCH_TERM> **/*.md
```

In the above example, the "quickfix" list will be populated with every instance of `<SEARCH_TERM>` in all `*.md` files in the current working directory, and all subdirectories.

To view the "quickfix" list and its contents, run the following command:

```
:cwindow
```

Then, approve and/or deny changes throughout the files with either `cdo` or `cfdo`. The following quotations come from the [user "romainl"](https://stackoverflow.com/questions/70003193/find-and-replace-all-instances-of-specific-string-in-multiple-files-in-vim/70004227#70004227).

`cdo` and `cfdo` "execute a command on all files listed in the quickfix list (a list of files generated by a search or error message). This method is useful when you want to replace text in a set of files generated by a search or error message".

To edit the files using `cdo`, "which will substitute every foo with bar on each line in the quickfix list and ask for confirmation", run the following command:

```
:cdo s/foo/bar/gc
```

In the above example:

- `g` represents "global"
- `c` will require each potential change to be approved or denied

To edit the files using `cfdo`, run the following command:

```
:cfdo %s/<PATTERN_TO_REPLACE>/<NEW_PATTERN>/gc
```

[A note from user "RaZ0rr"](https://stackoverflow.com/questions/70003193/find-and-replace-all-instances-of-specific-string-in-multiple-files-in-vim/70004227#70004227): "I feel like doing `:cfdo %s/foo/bar/gc` can have unexpected effects as opposed to `:cdo s/foo/bar/gc` because the former does the change file-wide and the latter does it only on the entries visible in the quickfix list. But this can be rare, as an instance in the file is most likely in the quickfix list."

Finally, save any unsaved changes by running `cfdo`, "which will write every file in the quickfix list to disk if they have been changed":

```
:cfdo update
```

## Performing "find and replace", starting outside of Vim

First, populate the "quickfix" list by running `grep`:

```
vim `find . -name '*.md' -exec grep -le '\<SEARCH_TERM\>' {} \;`
```

In the above example:

- `grep -l` returns file paths, for all files where the search term is found
- `grep -e` allows for pattern searching

Then, edit the files by running `bufdo`:

```
:bufdo %s/<PATTERN_TO_REPLACE>/<NEW_PATTERN>/gce
```

In the above example:

- `g` represents "global"
- `c` will require each potential change to be approved or denied
- `e` omits errors if the pattern isn't found

Finally, save by running `bufdo`:

```
:bufdo wq!
```

## References

- [StackOverflow - Vim - Find and replace all instances of specific string in multiple files in vim](https://stackoverflow.com/questions/70003193/find-and-replace-all-instances-of-specific-string-in-multiple-files-in-vim/70004227#70004227)
    - Reference for `cdo` and `cfdo` commands
- [FreeCodeCamp - How to Search-and-replace Across Multiple Files in Vim](https://www.freecodecamp.org/news/how-to-search-and-replace-across-multiple-files-in-vim/)
    - Reference for `bufdo` commands
